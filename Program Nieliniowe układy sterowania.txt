#define TEMP_0_PIN         13   // Analog Input
#define TEMP_1_PIN         15   // Analog Input
#define TEMP_BED_PIN       14   // Analog Input
#define a -5.30377404285076e-07
#define b 0.000913895174164941
#define c -0.619287460375456
#define d 250.544163050966


#include <stdlib.h>
#define X_STEP_PIN         54
#define X_DIR_PIN          55
#define X_ENABLE_PIN       38
#define X_CS_PIN           53

#define Y_STEP_PIN         60
#define Y_DIR_PIN          61
#define Y_ENABLE_PIN       56
#define Y_CS_PIN           49

#define Z_STEP_PIN         46
#define Z_DIR_PIN          48
#define Z_ENABLE_PIN       62
#define Z_CS_PIN           40

#define E0_STEP_PIN        26
#define E0_DIR_PIN         28
#define E0_ENABLE_PIN      24
#define E0_CS_PIN          42

#define E1_STEP_PIN        36
#define E1_DIR_PIN         34
#define E1_ENABLE_PIN      30
#define E1_CS_PIN          44

#define X_MIN_PIN           3
#ifndef X_MAX_PIN
#define X_MAX_PIN        2
#endif

#define Y_MIN_PIN          14
#define Y_MAX_PIN          15

#define Z_MIN_PIN          18
#define Z_MAX_PIN          19

#ifndef MOSFET_D_PIN
#define MOSFET_D_PIN     -1
#endif

#ifndef RAMPS_D8_PIN
#define RAMPS_D8_PIN      8
#endif

#ifndef RAMPS_D9_PIN
#define RAMPS_D9_PIN      9
#endif

#ifndef RAMPS_D10_PIN
#define RAMPS_D10_PIN    10
#endif

#define HEATER_0_PIN       RAMPS_D10_PIN

string czynnosc;
int wybtemp=200;
int temp;
int licznik1 = 0;
int zmiennatemp=1;
double x,y,a,b,c,i;
int krokx,krokz,kroky;
bool kierunekx,kierunekz,kieruneky;	
void setup()
{
  lcd.begin(20, 4);
  pinMode(HEATER_0_PIN, OUTPUT);
  Serial.begin(115200);
  pinMode(X_ENABLE_PIN, OUTPUT);
  digitalWrite(X_ENABLE_PIN, LOW);
  pinMode(X_DIR_PIN, OUTPUT);
  digitalWrite(X_DIR_PIN, LOW);
  pinMode(X_STEP_PIN, OUTPUT);
  digitalWrite(X_STEP_PIN, HIGH);

  pinMode(Y_ENABLE_PIN, OUTPUT);
  digitalWrite(Y_ENABLE_PIN, LOW);
  pinMode(Y_DIR_PIN, OUTPUT);
  digitalWrite(Y_DIR_PIN, LOW);
  pinMode(Y_STEP_PIN, OUTPUT);
  digitalWrite(Y_STEP_PIN, HIGH);

  pinMode(Z_ENABLE_PIN, OUTPUT);
  digitalWrite(Z_ENABLE_PIN, LOW);
  pinMode(Z_DIR_PIN, OUTPUT);
  digitalWrite(Z_DIR_PIN, LOW);
  pinMode(Z_STEP_PIN, OUTPUT);
  digitalWrite(Z_STEP_PIN, HIGH);

  pinMode(X_MAX_PIN, INPUT_PULLUP);
  pinMode(Y_MAX_PIN, INPUT_PULLUP);
  pinMode(Z_MAX_PIN, INPUT_PULLUP);

 

}


void loop()
{
Serial.println("Wybierz co chcesz zrobiæ?(dostepne: grzej, zero, pozycja, temp)");
while (Serial.available()){
    czynnosc = Serial.readStringUntil('\n');




if(czynnosc="grzej"){

	while(wybtemp>150){
	Serial.println("Do jakiej temperatury?");
	while (Serial.available()){
    wybtemp = Serial.readStringUntil('\n');
	}
	digitalWrite(HEATER_0_PIN, HIGH);
	
	
	while(){
	temp = analogRead(TEMP_0_PIN);
 	 Serial.println(temp);
 	 lcd.setCursor(0,0);
  	x = double(temp);
 	 y = a*x*x*x+b*x*x+c*x+d;
 	 lcd.print(y);
 	 if (y>=wybtemp){
	digitalWrite(HEATER_0_PIN, LOW);
	break;
	}
	delay(50);
  	}

break;
}

while(czynnosc="zero")
{


a = digitalRead(X_MAX_PIN);
  b= digitalRead(Y_MAX_PIN);
  c = digitalRead(Z_MAX_PIN);

  if (a == LOW)
  {
    digitalWrite(X_STEP_PIN, HIGH);
  }

  if (b == LOW)
  {
    digitalWrite(Y_STEP_PIN, HIGH);
  }

  if (c == LOW)
  {
    digitalWrite(Z_STEP_PIN, HIGH);
  }

if (a == HIGH && b == HIGH && c == HIGH){
  Serial.println("Ustawiono pozycje zerowa");
  digitalWrite(X_STEP_PIN, LOW);
  digitalWrite(Y_STEP_PIN, LOW);
  digitalWrite(Z_STEP_PIN, LOW);
  break;
}


}


if(czynnosc="pozycja"){
Serial.println("podaj ilosc krokow do zrobienia wed³ug wzoru krokiX | krokiY | krokiZ");

sscanf(a2.c_str(), "%d | %d | %d", &krokx, &kroky, &krokz);
 	while(1){
	kierunekx = krokx < 0;
      digitalWrite(X_DIR_PIN, kierunekx);
      krokx = krokx > 0 ? krokx : -krokx;

      kieruneky = kroky < 0;
      digitalWrite(Y_DIR_PIN, kieruneky);
      kroky = kroky > 0 ? kroky : -kroky;

      kierunekz = krokz < 0;
      digitalWrite(Z_DIR_PIN, kierunekz);
      krokz = krokz > 0 ? krokz : -krokz;

      if (krokx == 0 && kroky == 0 && krokz == 0)
      {
        break;
	
	}

	}

}


if(czynnosc="temp"){

	temp = analogRead(TEMP_0_PIN);
 	 Serial.println(temp);
 	 lcd.setCursor(0,0);
  	x = double(temp);
 	 y = a*x*x*x+b*x*x+c*x+d;
 	 lcd.print(y);

	delay(400);
}






}
























